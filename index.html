<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆê¿ˆ ì°¬ì–‘ ë¼ì´ë¸ŒëŸ¬ë¦¬</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background: #f0f2f5; color: #333; }
        .container { display: flex; height: 100vh; }
        
        /* ì™¼ìª½ íŒ¨ë„ */
        .library-panel { width: 350px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; box-shadow: 2px 0 5px rgba(0,0,0,0.05); z-index: 10; }
        .panel-header { padding: 20px; border-bottom: 1px solid #eee; background: #fff; }
        h2 { margin: 0 0 10px 0; color: #1a73e8; font-size: 1.2rem; }
        .status-msg { font-size: 12px; color: #666; margin-bottom: 5px; }
        
        .search-box { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        .song-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .song-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .song-item:hover { background-color: #f5f8fd; }
        .song-item label { flex-grow: 1; cursor: pointer; margin-left: 10px; font-weight: 500; }
        .song-item input[type="checkbox"] { transform: scale(1.2); cursor: pointer; }

        .action-area { padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; }
        .apply-btn { width: 100%; padding: 15px; background-color: #1a73e8; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .apply-btn:hover { background-color: #1557b0; }

        /* ì˜¤ë¥¸ìª½ íŒ¨ë„ */
        .player-panel { flex-grow: 1; padding: 40px; overflow-y: auto; background-color: #f0f2f5; }
        .audio-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; animation: fadeIn 0.3s ease-in-out; }
        .track-info { display: flex; align-items: center; gap: 15px; flex-grow: 1; }
        .track-num { font-size: 18px; font-weight: bold; color: #1a73e8; width: 30px; }
        .track-title { font-size: 18px; font-weight: bold; color: #333; }
        audio { height: 40px; width: 350px; outline: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .empty-state { text-align: center; color: #888; margin-top: 100px; }
    </style>
</head>
<body>

<div class="container">
    <div class="library-panel">
        <div class="panel-header">
            <h2>ğŸ“‚ songs í´ë” ìë™ ìŠ¤ìº”</h2>
            <div id="statusMsg" class="status-msg">íŒŒì¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <input type="text" id="searchInput" class="search-box" placeholder="ì œëª© ê²€ìƒ‰..." onkeyup="filterList()">
        </div>
        <div class="song-list" id="libraryList">
            </div>
        <div class="action-area">
            <button class="apply-btn" onclick="generatePlayers()">ì„ íƒí•œ ê³¡ ìƒì„± â–¶</button>
        </div>
    </div>

    <div class="player-panel" id="playerContainer">
        <div class="empty-state">
            <h3>songs í´ë”ì— ìˆëŠ” íŒŒì¼ì„<br>ìë™ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.</h3>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // [ì„¤ì •] ì—¬ê¸°ë§Œ ë³¸ì¸ ê¹ƒí—ˆë¸Œ ì •ë³´ë¡œ ë°”ê¿”ì£¼ì„¸ìš”!
    // ============================================================
    const GITHUB_USERNAME = 'wook-dragon';  // ê¹ƒí—ˆë¸Œ ì•„ì´ë””
    const REPO_NAME = 'weryechurch';        // ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„
    const FOLDER_NAME = 'songs';            // ìŒì› í´ë” ì´ë¦„
    // ============================================================

    let allSongs = []; // ë¶ˆëŸ¬ì˜¨ ë…¸ë˜ ëª©ë¡ ì €ì¥ì†Œ

    // 1. GitHub APIë¡œ songs í´ë” ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
    async function loadSongsFromGitHub() {
        const statusMsg = document.getElementById('statusMsg');
        const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FOLDER_NAME}`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            
            const data = await response.json();
            
            // mp3 íŒŒì¼ë§Œ ê³¨ë¼ë‚´ê¸°
            allSongs = data
                .filter(item => item.name.toLowerCase().endsWith('.mp3'))
                .map(item => ({
                    title: item.name.replace('.mp3', '').replace('.MP3', ''), // í™•ì¥ì ë–¼ê³  ì œëª©ìœ¼ë¡œ ì”€
                    url: item.download_url // ì‹¤ì œ mp3 íŒŒì¼ ì£¼ì†Œ
                }));

            renderLibrary(allSongs);
            statusMsg.innerText = `ì´ ${allSongs.length}ê³¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`;
            statusMsg.style.color = 'green';

        } catch (error) {
            console.error(error);
            statusMsg.innerText = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨! (ì„¤ì •ì´ë‚˜ í´ë”ëª…ì„ í™•ì¸í•˜ì„¸ìš”)";
            statusMsg.style.color = 'red';
        }
    }

    // 2. ë¦¬ìŠ¤íŠ¸ í™”ë©´ì— ê·¸ë¦¬ê¸°
    function renderLibrary(items) {
        const list = document.getElementById('libraryList');
        list.innerHTML = '';
        items.forEach((song, index) => {
            const div = document.createElement('div');
            div.className = 'song-item';
            div.innerHTML = `
                <input type="checkbox" id="song-${index}" value="${index}">
                <label for="song-${index}">${song.title}</label>
            `;
            list.appendChild(div);
        });
    }

    // 3. ê²€ìƒ‰ ê¸°ëŠ¥
    function filterList() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const items = document.querySelectorAll('.song-item');
        items.forEach(item => {
            const text = item.querySelector('label').innerText.toLowerCase();
            item.style.display = text.includes(query) ? 'flex' : 'none';
        });
    }

    // 4. í”Œë ˆì´ì–´ ìƒì„±
    function generatePlayers() {
        const container = document.getElementById('playerContainer');
        const checkboxes = document.querySelectorAll('.song-list input:checked');
        
        if (checkboxes.length === 0) {
            alert("ê³¡ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        container.innerHTML = '';
        let count = 1;

        checkboxes.forEach(chk => {
            const song = allSongs[chk.value]; // ì €ì¥ëœ ëª©ë¡ì—ì„œ ê°€ì ¸ì˜´
            const card = document.createElement('div');
            card.className = 'audio-card';
            card.innerHTML = `
                <div class="track-info">
                    <span class="track-num">${count++}</span>
                    <span class="track-title">${song.title}</span>
                </div>
                <audio controls controlsList="nodownload">
                    <source src="${song.url}" type="audio/mpeg">
                </audio>
            `;
            container.appendChild(card);
        });
    }

    // í˜ì´ì§€ ì—´ë¦¬ìë§ˆì ì‹¤í–‰
    loadSongsFromGitHub();

</script>

</body>
</html>