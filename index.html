<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆê¿ˆ ì°¬ì–‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìˆœì„œë²ˆí˜¸)</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background: #f0f2f5; color: #333; }
        .container { display: flex; height: 100vh; }
        
        /* ì™¼ìª½ íŒ¨ë„ */
        .library-panel { width: 350px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; box-shadow: 2px 0 5px rgba(0,0,0,0.05); z-index: 10; }
        .panel-header { padding: 20px; border-bottom: 1px solid #eee; background: #fff; }
        h2 { margin: 0 0 10px 0; color: #1a73e8; font-size: 1.2rem; }
        .status-msg { font-size: 12px; color: #666; margin-bottom: 5px; }
        
        .search-box { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        .song-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        
        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .song-item { 
            display: flex; align-items: center; padding: 12px 10px; 
            border-bottom: 1px solid #f0f0f0; cursor: pointer; 
            transition: background 0.1s; user-select: none;
            position: relative; /* ë±ƒì§€ ìœ„ì¹˜ ì¡ê¸° ìœ„í•´ */
        }
        .song-item:hover { background-color: #f5f8fd; }
        .song-item.selected { background-color: #e8f0fe; font-weight: bold; color: #1a73e8; }

        .song-item label { flex-grow: 1; cursor: pointer; margin-left: 10px; font-weight: 500; pointer-events: none; }
        .song-item input[type="checkbox"] { transform: scale(1.2); cursor: pointer; pointer-events: none; }

        /* [NEW] ìˆœì„œ ë²ˆí˜¸ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .order-badge {
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            background-color: #1a73e8; color: white;
            border-radius: 50%; width: 24px; height: 24px;
            align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold;
            margin-left: auto; /* ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ ë°€ê¸° */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        /* ì„ íƒë˜ë©´ ì²´í¬ë°•ìŠ¤ ìˆ¨ê¸°ê³  ë±ƒì§€ ë³´ì—¬ì£¼ê¸° */
        .song-item.selected input[type="checkbox"] { display: none; }
        .song-item.selected .order-badge { display: flex; }

        /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
        .action-area { 
            padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; 
            display: flex; gap: 10px; 
        }
        .apply-btn { 
            flex: 2; padding: 15px; background-color: #1a73e8; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .apply-btn:hover { background-color: #1557b0; }

        .reset-btn { 
            flex: 1; padding: 15px; background-color: #95a5a6; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .reset-btn:hover { background-color: #7f8c8d; }

        /* ì˜¤ë¥¸ìª½ íŒ¨ë„ */
        .player-panel { flex-grow: 1; padding: 40px; overflow-y: auto; background-color: #f0f2f5; }
        .audio-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; animation: fadeIn 0.3s ease-in-out; }
        .track-info { display: flex; align-items: center; gap: 15px; flex-grow: 1; }
        .track-num { font-size: 18px; font-weight: bold; color: #1a73e8; width: 30px; }
        .track-title { font-size: 18px; font-weight: bold; color: #333; }
        audio { height: 40px; width: 350px; outline: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .empty-state { text-align: center; color: #888; margin-top: 100px; }
    </style>
</head>
<body>

<div class="container">
    <div class="library-panel">
        <div class="panel-header">
            <h2>ğŸ“‚ songs í´ë” ìë™ ìŠ¤ìº”</h2>
            <div id="statusMsg" class="status-msg">íŒŒì¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <input type="text" id="searchInput" class="search-box" placeholder="ì œëª© ê²€ìƒ‰..." onkeyup="filterList()">
        </div>
        <div class="song-list" id="libraryList">
            </div>
        <div class="action-area">
            <button class="reset-btn" onclick="resetAll()">ì´ˆê¸°í™” â†º</button>
            <button class="apply-btn" onclick="generatePlayers()">ì„ íƒ ì ìš© â–¶</button>
        </div>
    </div>

    <div class="player-panel" id="playerContainer">
        <div class="empty-state">
            <h3>ì˜¤ëŠ˜ ì˜ˆë°°ë“œë¦´ ì°¬ì–‘ì„<br><b>ìˆœì„œëŒ€ë¡œ</b> ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // [ì„¤ì •] ê¹ƒí—ˆë¸Œ ì •ë³´
    // ============================================================
    const GITHUB_USERNAME = 'wook-dragon';
    const REPO_NAME = 'weryechurch';
    const FOLDER_NAME = 'songs';
    // ============================================================

    let allSongs = [];
    let selectedIndices = []; // í´ë¦­í•œ ìˆœì„œë¥¼ ê¸°ì–µí•˜ëŠ” ë°°ì—´

    async function loadSongsFromGitHub() {
        const statusMsg = document.getElementById('statusMsg');
        const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FOLDER_NAME}`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            
            const data = await response.json();
            
            allSongs = data
                .filter(item => item.name.toLowerCase().endsWith('.mp3'))
                .map(item => ({
                    title: item.name.replace('.mp3', '').replace('.MP3', ''),
                    url: item.download_url
                }));

            renderLibrary(allSongs);
            statusMsg.innerText = `ì´ ${allSongs.length}ê³¡ ë¡œë“œ ì™„ë£Œ`;
            statusMsg.style.color = 'green';

        } catch (error) {
            console.error(error);
            statusMsg.innerText = "ë¡œë“œ ì‹¤íŒ¨! (API í•œë„ ì´ˆê³¼ ë“±)";
            statusMsg.style.color = 'red';
        }
    }

    function renderLibrary(items) {
        const list = document.getElementById('libraryList');
        list.innerHTML = '';
        
        items.forEach((song, index) => {
            const div = document.createElement('div');
            div.className = 'song-item';
            div.id = `item-${index}`; 
            
            div.onclick = function() {
                const checkbox = this.querySelector('input[type="checkbox"]');
                
                // ì´ë¯¸ ì„ íƒëœ ê±´ì§€ í™•ì¸
                const alreadySelectedIndex = selectedIndices.indexOf(index);

                if (alreadySelectedIndex === -1) {
                    // ì„ íƒ ì•ˆ ëœê±°ë©´ -> ì¶”ê°€
                    selectedIndices.push(index);
                    checkbox.checked = true;
                } else {
                    // ì´ë¯¸ ì„ íƒëœ ê±°ë©´ -> ì‚­ì œ
                    selectedIndices.splice(alreadySelectedIndex, 1);
                    checkbox.checked = false;
                }

                // [ì¤‘ìš”] ëª¨ë“  ë±ƒì§€ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                updateBadges();
            };

            div.innerHTML = `
                <input type="checkbox" id="song-${index}" value="${index}">
                <label for="song-${index}">${song.title}</label>
                <span class="order-badge">0</span> `;
            list.appendChild(div);
        });
    }

    // [í•µì‹¬] ë±ƒì§€ ë²ˆí˜¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateBadges() {
        // 1. ëª¨ë“  ì•„ì´í…œ ì´ˆê¸°í™” (ì„ íƒ í•´ì œëœ ê²ƒì²˜ëŸ¼)
        const allItems = document.querySelectorAll('.song-item');
        allItems.forEach(item => {
            item.classList.remove('selected');
            item.querySelector('input').checked = false;
        });

        // 2. selectedIndices ë°°ì—´ì— ìˆëŠ” ì• ë“¤ë§Œ ë²ˆí˜¸ ë§¤ê¸°ê¸°
        selectedIndices.forEach((songIndex, arrayPos) => {
            const item = document.getElementById(`item-${songIndex}`);
            if (item) {
                item.classList.add('selected'); // íŒŒë€ ë°°ê²½ & ì²´í¬ë°•ìŠ¤ ìˆ¨ê¹€
                item.querySelector('input').checked = true;
                
                // ë±ƒì§€ ìˆ«ì ì—…ë°ì´íŠ¸ (ë°°ì—´ ìˆœì„œ + 1)
                item.querySelector('.order-badge').innerText = arrayPos + 1;
            }
        });
    }

    function filterList() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        const items = document.querySelectorAll('.song-item');
        items.forEach(item => {
            const text = item.querySelector('label').innerText.toLowerCase();
            item.style.display = text.includes(query) ? 'flex' : 'none';
        });
    }

    function generatePlayers() {
        const container = document.getElementById('playerContainer');
        if (selectedIndices.length === 0) {
            alert("ê³¡ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        container.innerHTML = '';
        let count = 1;

        selectedIndices.forEach(index => {
            const song = allSongs[index];
            const card = document.createElement('div');
            card.className = 'audio-card';
            card.innerHTML = `
                <div class="track-info">
                    <span class="track-num">${count++}</span>
                    <span class="track-title">${song.title}</span>
                </div>
                <audio controls controlsList="nodownload">
                    <source src="${song.url}" type="audio/mpeg">
                </audio>
            `;
            container.appendChild(card);
        });
    }

    function resetAll() {
        selectedIndices = [];
        updateBadges(); // í™”ë©´ ì´ˆê¸°í™”
        document.getElementById('playerContainer').innerHTML = `
            <div class="empty-state">
                <h3>ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ìˆœì„œëŒ€ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
            </div>
        `;
    }

    loadSongsFromGitHub();

</script>

</body>
</html>
