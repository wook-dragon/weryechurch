<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEë¡€êµíšŒ ì˜ˆê¿ˆ ì°¬ì–‘ ë¼ì´ë¸ŒëŸ¬ë¦¬</title>
    <link rel="icon" href="images/logo.png" type="image/png">

    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background: #fdfdfd; color: #333; }
        .container { display: flex; height: 100vh; }
        
        /* [1] ì™¼ìª½ íŒ¨ë„ */
        .library-panel { 
            width: 350px; background: white; border-right: 1px solid #eee; 
            display: flex; flex-direction: column; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.03); z-index: 10; flex-shrink: 0;
        }
        .panel-header { padding: 20px; border-bottom: 1px solid #eee; background: #fff; }
        
        h2 { margin: 0 0 10px 0; color: #1a5432; font-size: 1.2rem; display: flex; align-items: center; }
        h2 img { height: 28px; margin-right: 8px; object-fit: contain; }
        .status-msg { font-size: 12px; color: #888; margin-bottom: 5px; }
        
        .search-box { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; transition: border 0.2s;}
        .search-box:focus { border-color: #5ea132; } 

        .song-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        
        .song-item { 
            display: flex; align-items: center; padding: 12px 15px; 
            border-bottom: 1px solid #f5f5f5; cursor: pointer; 
            transition: all 0.1s; user-select: none;
            border-radius: 8px; margin-bottom: 2px; color: #555; 
        }
        .song-item:hover { background-color: rgba(94, 161, 50, 0.08); } 
        .song-item.selected { background-color: rgba(26, 84, 50, 0.08); font-weight: bold; color: #1a5432; }
        .note-icon { margin-right: 12px; color: #ccc; font-size: 14px; transition: color 0.2s; }
        .song-item.selected .note-icon { color: #1a5432; }
        .song-title { flex-grow: 1; pointer-events: none; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .order-badge {
            display: none; background-color: #5ea132; color: white;
            border-radius: 50%; width: 24px; height: 24px;
            align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; margin-left: auto;
            box-shadow: 0 2px 4px rgba(26, 84, 50, 0.2); flex-shrink: 0;
        }
        .song-item.selected .order-badge { display: flex; }

        .action-area { padding: 20px; border-top: 1px solid #eee; background: #fff; display: flex; gap: 10px; }
        .apply-btn { 
            flex: 2; padding: 15px; background-color: #1a5432; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 6px rgba(26, 84, 50, 0.2);
        }
        .apply-btn:hover { background-color: #5ea132; transform: translateY(-1px); }
        .reset-btn { 
            flex: 1; padding: 15px; background-color: #95a5a6; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .reset-btn:hover { background-color: #7f8c8d; }

        /* [2] í•˜ë‹¨ íŒ¨ë„ */
        .bottom-section {
            flex-grow: 1; display: flex; flex-direction: column;
            background-color: #fafafa;
        }

        .player-panel { flex: 1; padding: 40px; overflow-y: auto; }

        /* [ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ ë””ìì¸] */
        .audio-card { 
            background: white; border-radius: 12px; padding: 15px 25px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #eee;
            border-left: 5px solid #1a5432; 
            display: flex; flex-direction: column; gap: 10px;
            animation: fadeIn 0.3s ease-in-out; 
        }

        .card-header {
            display: flex; align-items: center; justify-content: space-between;
        }
        .track-info { display: flex; align-items: center; gap: 10px; overflow: hidden; }
        .track-num { font-size: 18px; font-weight: bold; color: #1a5432; }
        .track-title { font-size: 18px; font-weight: bold; color: #333; }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ (ì¬ìƒë°”, ë²„íŠ¼, ë³¼ë¥¨) */
        .controls-row {
            display: flex; align-items: center; gap: 15px;
        }

        /* ì¬ìƒ ë²„íŠ¼ */
        .play-btn {
            background: #1a5432; color: white; border: none; border-radius: 50%;
            width: 36px; height: 36px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 14px; flex-shrink: 0; transition: background 0.2s;
        }
        .play-btn:hover { background: #5ea132; }

        /* ì§„í–‰ ë°” & ë³¼ë¥¨ ë°” ê³µí†µ ìŠ¤íƒ€ì¼ (ìŠ¬ë¼ì´ë”) */
        input[type=range] {
            -webkit-appearance: none; background: transparent; cursor: pointer;
        }
        input[type=range]:focus { outline: none; }
        
        /* ìŠ¬ë¼ì´ë” íŠ¸ë™ (ì¤„) */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; background: #e0e0e0; border-radius: 3px;
        }
        /* ìŠ¬ë¼ì´ë” ì¸ (ë™ê·¸ë¼ë¯¸) */
        input[type=range]::-webkit-slider-thumb {
            height: 14px; width: 14px; border-radius: 50%; background: #1a5432;
            -webkit-appearance: none; margin-top: -4px; transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); background: #5ea132; }

        /* ì§„í–‰ ë°” (ê¸¸ê²Œ) */
        .progress-bar { flex-grow: 1; }
        
        /* ì‹œê°„ í…ìŠ¤íŠ¸ */
        .time-display { font-size: 12px; color: #666; font-variant-numeric: tabular-nums; width: 80px; text-align: center; }

        /* ë³¼ë¥¨ ì˜ì—­ */
        .volume-area { display: flex; align-items: center; gap: 5px; width: 100px; }
        .volume-icon { font-size: 16px; color: #666; cursor: pointer; }
        .volume-slider { width: 100%; }

        /* ë©”ëª¨ì¥ ì˜ì—­ */
        .memo-panel {
            height: 200px; padding: 20px 40px; background-color: #fff; border-top: 1px solid #ddd;
            display: flex; flex-direction: column;
        }
        .memo-header { font-size: 14px; font-weight: bold; color: #1a5432; margin-bottom: 10px; }
        .memo-textarea {
            flex-grow: 1; width: 100%; border: 1px solid #eee; border-radius: 8px;
            padding: 15px; font-size: 14px; line-height: 1.6; resize: none;
            background-color: #f9fdfa; font-family: 'Pretendard', sans-serif; outline: none; box-sizing: border-box;
        }
        .memo-textarea:focus { border-color: #5ea132; background-color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .empty-state { text-align: center; color: #aaa; margin-top: 100px; }
    </style>
</head>
<body>

<div class="container">
    <div class="library-panel">
        <div class="panel-header">
            <h2>
                <img src="images/logo.png" alt="ë¡œê³ " onerror="this.style.display='none'">
                ì˜ˆê¿ˆ ì°¬ì–‘ ë¼ì´ë¸ŒëŸ¬ë¦¬
            </h2>
            <div id="statusMsg" class="status-msg">íŒŒì¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <input type="text" id="searchInput" class="search-box" placeholder="ì œëª© ê²€ìƒ‰..." onkeyup="filterList()">
        </div>
        <div class="song-list" id="libraryList"></div>
        <div class="action-area">
            <button class="reset-btn" onclick="resetAll()">ì´ˆê¸°í™” â†º</button>
            <button class="apply-btn" onclick="generatePlayers()">ì„ íƒ ì ìš© â–¶</button>
        </div>
    </div>

    <div class="bottom-section">
        <div class="player-panel" id="playerContainer">
            <div class="empty-state">
                <h3>ì˜¤ëŠ˜ ì˜ˆë°°ë“œë¦´ ì°¬ì–‘ì„<br><b>ìˆœì„œëŒ€ë¡œ</b> ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
            </div>
        </div>

        <div class="memo-panel">
            <div class="memo-header">ğŸ“ ì˜ˆë°° ì§„í–‰ ë©”ëª¨</div>
            <textarea class="memo-textarea" placeholder="ì—¬ê¸°ì— ì°¬ì–‘íŒ€ ë©˜íŠ¸ë‚˜ ì§„í–‰ ìˆœì„œë¥¼ ì ì–´ë‘ì„¸ìš”."></textarea>
        </div>
    </div>
</div>

<script>
    const GITHUB_USERNAME = 'wook-dragon';
    const REPO_NAME = 'weryechurch';
    const FOLDER_NAME = 'songs';

    // [ì¤‘ìš”] ë¹„ìƒìš© í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸ (API ì˜¤ë¥˜ ì‹œ ì‚¬ìš©)
    const FALLBACK_SONGS = [
        "ë‚˜ëŠ” ì˜ˆë°°ìì…ë‹ˆë‹¤.mp3",
        "ë„ˆì™€ ë‚˜ì˜ ëª¨ìŠµì´.mp3",
        "ë”°ë¼ë”°ë¼ ê°ˆë˜ìš”.mp3",
        "ì‚¬ë„ì‹ ê²½ì†¡.mp3",
        "ìƒëª… ì£¼ê»˜ ìˆë„¤.mp3",
        "ì£¼ì˜ ë§ì”€ì€ ë‚´ ë°œì— ë“±ì´ìš”(ì‹œí¸119í¸105ì ˆ).mp3",
        "ìµœê³ ì˜ ì„ ë¬¼.mp3",
        "ë¯¿ìŒìœ¼ë¡œ ëª¨ë“  ì„¸ê³„ê°€(íˆë¸Œë¦¬ì„œ11ì¥3ì ˆìƒë°˜ì ˆ).mp3"
    ];

    let allSongs = [];
    let selectedIndices = []; 

    async function loadSongsFromGitHub() {
        const statusMsg = document.getElementById('statusMsg');
        const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FOLDER_NAME}`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            const data = await response.json();
            
            allSongs = data
                .filter(item => item.name.toLowerCase().endsWith('.mp3'))
                .map(item => ({
                    title: item.name.replace('.mp3', '').replace('.MP3', ''),
                    url: item.download_url
                }))
                .sort((a, b) => a.title.localeCompare(b.title, 'ko'));

            renderLibrary(allSongs);
            statusMsg.innerText = `ì´ ${allSongs.length}ê³¡ ë¡œë“œ ì™„ë£Œ`;
            statusMsg.style.color = '#1a5432'; 

        } catch (error) {
            console.error(error);
            
            // [ë¹„ìƒ ëª¨ë“œ ì‘ë™] í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸ë¡œ ëª©ë¡ ìƒì„±
            allSongs = FALLBACK_SONGS.map(filename => ({
                title: filename.replace('.mp3', '').replace('.MP3', ''),
                // ê¹ƒí—ˆë¸Œ í˜ì´ì§€ URL ê·œì¹™ëŒ€ë¡œ ì£¼ì†Œ ìƒì„± (íŒŒì¼ëª… ì¸ì½”ë”©)
                url: `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/${FOLDER_NAME}/${encodeURIComponent(filename)}`
            })).sort((a, b) => a.title.localeCompare(b.title, 'ko'));

            renderLibrary(allSongs);

            statusMsg.innerText = `âš ï¸ ë¹„ìƒ ëª¨ë“œ: ${allSongs.length}ê³¡`;
            statusMsg.style.color = '#e67e22'; // ì£¼í™©ìƒ‰ ê²½ê³ 
        }
    }

    function renderLibrary(items) {
        const list = document.getElementById('libraryList');
        list.innerHTML = '';
        
        items.forEach((song, index) => {
            const div = document.createElement('div');
            div.className = 'song-item';
            div.id = `item-${index}`; 
            
            div.onclick = function() {
                const alreadySelectedIndex = selectedIndices.indexOf(index);
                if (alreadySelectedIndex === -1) {
                    selectedIndices.push(index);
                } else {
                    selectedIndices.splice(alreadySelectedIndex, 1);
                }
                updateBadges();
            };

            div.innerHTML = `
                <span class="note-icon">ğŸµ</span>
                <span class="song-title">${song.title}</span>
                <span class="order-badge">0</span>
            `;
            list.appendChild(div);
        });
    }

    function updateBadges() {
        const allItems = document.querySelectorAll('.song-item');
        allItems.forEach(item => { item.classList.remove('selected'); });

        selectedIndices.forEach((songIndex, arrayPos) => {
            const item = document.getElementById(`item-${songIndex}`);
            if (item) {
                item.classList.add('selected'); 
                item.querySelector('.order-badge').innerText = arrayPos + 1; 
            }
        });
    }

    function filterList() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        const items = document.querySelectorAll('.song-item');
        items.forEach(item => {
            const text = item.querySelector('.song-title').innerText.toLowerCase();
            item.style.display = text.includes(query) ? 'flex' : 'none';
        });
    }

    // [í•µì‹¬] ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ ìƒì„± í•¨ìˆ˜
    function generatePlayers() {
        const container = document.getElementById('playerContainer');
        if (selectedIndices.length === 0) { alert("ê³¡ì„ ì„ íƒí•´ì£¼ì„¸ìš”!"); return; }

        container.innerHTML = '';
        let count = 1;

        selectedIndices.forEach((index, i) => {
            const song = allSongs[index];
            const uniqueId = `player-${i}`;
            
            const card = document.createElement('div');
            card.className = 'audio-card';
            
            // ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ HTML êµ¬ì¡°
            card.innerHTML = `
                <div class="card-header">
                    <div class="track-info">
                        <span class="track-num">${count++}</span>
                        <span class="track-title">${song.title}</span>
                    </div>
                </div>
                
                <div class="controls-row">
                    <button class="play-btn" id="btn-${uniqueId}" onclick="togglePlay('${uniqueId}')">â–¶</button>
                    
                    <input type="range" class="progress-bar" id="progress-${uniqueId}" value="0" min="0" step="0.1" oninput="seekAudio('${uniqueId}', this.value)">
                    
                    <span class="time-display" id="time-${uniqueId}">0:00 / 0:00</span>
                    
                    <div class="volume-area">
                        <span class="volume-icon" onclick="toggleMute('${uniqueId}')">ğŸ”Š</span>
                        <input type="range" class="volume-slider" id="vol-${uniqueId}" value="1" min="0" max="1" step="0.1" oninput="setVolume('${uniqueId}', this.value)">
                    </div>
                </div>

                <audio id="${uniqueId}" src="${song.url}" preload="metadata" ontimeupdate="updateProgress('${uniqueId}')" onloadedmetadata="initDuration('${uniqueId}')" onended="resetPlayer('${uniqueId}')"></audio>
            `;
            container.appendChild(card);
        });
    }

    // --- í”Œë ˆì´ì–´ ì œì–´ ê¸°ëŠ¥ë“¤ ---

    function togglePlay(id) {
        const audio = document.getElementById(id);
        const btn = document.getElementById(`btn-${id}`);
        
        if (audio.paused) {
            audio.play();
            btn.innerText = "âšâš"; // ì¼ì‹œì •ì§€ ì•„ì´ì½˜
        } else {
            audio.pause();
            btn.innerText = "â–¶";
        }
    }

    function updateProgress(id) {
        const audio = document.getElementById(id);
        const progressBar = document.getElementById(`progress-${id}`);
        const timeDisplay = document.getElementById(`time-${id}`);
        
        if (!isNaN(audio.duration)) {
            progressBar.max = audio.duration;
            progressBar.value = audio.currentTime;
            timeDisplay.innerText = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        }
    }

    function seekAudio(id, value) {
        const audio = document.getElementById(id);
        audio.currentTime = value;
    }

    function setVolume(id, value) {
        const audio = document.getElementById(id);
        audio.volume = value;
    }

    function toggleMute(id) {
        const audio = document.getElementById(id);
        const volSlider = document.getElementById(`vol-${id}`);
        
        if (audio.muted) {
            audio.muted = false;
            volSlider.value = audio.volume; // ì›ë˜ ë³¼ë¥¨ìœ¼ë¡œ ë³µê·€
        } else {
            audio.muted = true;
            volSlider.value = 0;
        }
    }

    function initDuration(id) {
        const audio = document.getElementById(id);
        const timeDisplay = document.getElementById(`time-${id}`);
        timeDisplay.innerText = `0:00 / ${formatTime(audio.duration)}`;
    }

    function resetPlayer(id) {
        const btn = document.getElementById(`btn-${id}`);
        btn.innerText = "â–¶"; // ì¬ìƒ ëë‚¬ì„ ë•Œ ë²„íŠ¼ ë³µê·€
    }

    function formatTime(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec < 10 ? '0' : ''}${sec}`;
    }

    function resetAll() {
        selectedIndices = [];
        updateBadges(); 
        document.getElementById('playerContainer').innerHTML = `
            <div class="empty-state">
                <h3>ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ìˆœì„œëŒ€ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
            </div>
        `;
    }

    loadSongsFromGitHub();

</script>

</body>
</html>